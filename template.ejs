<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title></title>
        <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <script> try { var $ = jQuery = require("jquery") } catch(err) {} </script>
        <script src="<%= sk.routes.frontend.sk%>libs/jquery/dist/jquery.slim.min.js"></script>
        <script src="<%= sk.routes.frontend.sk%>libs/jquery/jquery-ui/jquery-ui.min.js"></script>


        <link rel="stylesheet" href="<%= sk.routes.frontend.sk%>libs/formantic-ui/semantic.css"/>
        <script src="<%= sk.routes.frontend.sk%>libs/formantic-ui/semantic.min.js"></script>
        

        <link rel="stylesheet" type="text/css" href="<%= sk.routes.frontend.sk%>libs/jsom/jsom.css">
        <script src="<%= sk.routes.frontend.sk%>libs/jsom/jsom.js"></script>


        <script src="<%= sk.routes.frontend.sk%>libs/sk_comm/sk_comm_<%= app_type %>.js"></script>
        <script src="<%= sk.routes.frontend.sk%>libs/sk_comm/sk_comm_core.js"></script>

        <script src="<%= sk.routes.frontend.sk%>libs/sk_dialog/sk_dialog_<%= app_type %>.js"></script>
        <script src="<%= sk.routes.frontend.sk%>libs/sk_dialog/sk_dialog_core.js"></script>


        <script src="<%= sk.routes.frontend.sk%>libs/sk_fileDrop/sk_fileDrop.js"></script>

        <script src="<%= sk.routes.frontend.sk%>libs/sk_tween.js"></script>

        <% if (app_type === 'dapp'){ %>
            <script src="<%= sk.routes.frontend.sk%>libs/sk_viewController/sk_viewController.js"></script>
        <% } %>
        <script src="<%= sk.routes.frontend.sk%>libs/sk_ums/sk_ums.js"></script>


        <!--<link rel="stylesheet" type="text/css" href="<%= sk.routes.frontend.sk%>libs/sk_contextMenu/sk_contextMenu.css">
        <script src="<%= sk.routes.frontend.sk%>libs/sk_contextMenu/sk_contextMenu.js"></script>-->

        <script src="<%= sk.routes.frontend.sk%>libs/sk_childMngr/sk_childMngr.js"></script>

        

        <script src="<%= sk.routes.frontend.sk%>libs/js-cookie/js.cookie.min.js"></script>

        <%- include(globalHead) %>
        <%- include(viewHead) %>

        <script src="<%= sk.routes.frontend.sk%>libs/sk_hint/sk_hint.js"></script>
    </head>

    <%- include(sk.ui.head) %>

    <% if (sk.useComplexity){ %>
        <head>
            <link rel="stylesheet" type="text/css" href="<%= sk.routes.frontend.complexity %>complexity.css">
            <script src="<%= sk.routes.frontend.complexity %>icons.js"></script>
            <script src="<%= sk.routes.frontend.complexity %>comm.js"></script>
            <script src="<%= sk.routes.frontend.complexity %>selectionManager.js"></script>
            <script src="<%= sk.routes.frontend.complexity %>complexity.js"></script>


            <script src="<%= sk.routes.frontend.complexity %>editor/components/objectTree.js"></script>
            <script src="<%= sk.routes.frontend.complexity %>editor/components/stylingEditor.js"></script>
            <script src="<%= sk.routes.frontend.complexity %>editor/components/attributeEditor.js"></script>
            <script src="<%= sk.routes.frontend.complexity %>editor/components/iconList.js"></script>

            

            <link rel="stylesheet" href="<%= sk.routes.frontend.complexity %>codeEditor/codemirror/theme/vscode-dark.css">

            <link rel="stylesheet" href="<%= sk.routes.frontend.complexity %>codeEditor/codemirror/lib/codemirror.css">
            <script src="<%= sk.routes.frontend.complexity %>codeEditor/codemirror/lib/codemirror.js"></script>
            <script src="<%= sk.routes.frontend.complexity %>codeEditor/codemirror/mode/javascript/javascript.js"></script>
            <script src="<%= sk.routes.frontend.complexity %>codeEditor/bakery.js"></script>
            <script src="<%= sk.routes.frontend.complexity %>codeEditor/codeEditor.js"></script>

            <script src="<%= sk.routes.frontend.complexity %>editor/editor.js"></script>
        </head>
    <% } %>
    
    <body>
        <%- include(viewBodyScripts.start) %>
        
        <script src="<%= sk.routes.frontend.view %>view.js"></script>

        <%- include(sk.ui.script) %>

        <script>
            sk.l10n = <%- JSON.stringify(l10n) %>
        </script>
        <script src="<%= sk.routes.frontend.sk%>libs/sk_l10n/sk_l10n.js"></script>

        <script>
             <% if (sk.useComplexity){ %>
                sk.complexity = {
                    core: new sk_ui_complexity()
                }
                sk.complexity.comm = new sk_ui_complexity_comm()
                sk.complexity.comm.init()
            <% } %>

            
            
            sk.userData = <%- JSON.stringify(userData) %>



            sk.ums = new SK_UMS()

            sk.init().then(()=>{
                sk.app = (new sk_ui_component({parent: {element: document.body}}))
                sk.app.setup(_c => {
                    sk._cM = _c.contextMenu

                    _c.classAdd('sk_app')

                    _c.styling = 'ttb'

                    if (sk.app_type === 'dapp' && !sk.noTitle){
                        _c.titlebar = _c.add.dappTitlebar(_c => {
                            _c.os    = sk.os
                            _c.title = sk.title
                            _c.icon  = sk.paths.icon
                        })
                    }
                    

                    _c.body = _c.add.component(_c => {
                        _c.classAdd('sk_ui_appBody ' + (sk.app_type !== 'dapp' || sk.noTitle ? 'sk_ui_noTitlebar' : ''))
                    
                        _c.view = new sk._view({parent: _c})
                        _c.children.add(_c.view)
                    })

                    <% if (sk.useComplexity){ %>
                        sk.complexity.editor = new sk_ui_complexity_editor({app: _c})
                        sk.complexity.codeEditor = new sk_ui_complexity_codeEditor(_c)
                    <% } %>
                })
            })

            if (sk.app_type === 'dapp'){
                document.body.onresize = event => {
                    if (!sk.window.resizing) sk.window.maximize(true)
                }

                function updateOnlineStatus () {
                    sk.online = navigator.onLine
                    //sk.online = false
                    sk.comm.main('setOnlineStatus', {online: sk.online})
                    sk.ums.broadcast('isOnline', undefined, sk.online)
                }
            
                window.addEventListener('online'  , ()=>{ updateOnlineStatus() })
                window.addEventListener('offline' , ()=>{ updateOnlineStatus() })
                updateOnlineStatus()
            }
            

            document.addEventListener('mousedown', _e => {
                document.querySelectorAll('.sk_ui_contextMenu').forEach(_c => { _c.sk_ui_obj.close({fromGlobal: true}) })
            })

            document.addEventListener('keydown', _e => {
                if (_e.code = 27) return document.querySelectorAll('.sk_ui_contextMenu').forEach(_c => { _c.sk_ui_obj.close() })

                //sk.shortcuts.tryExecute(_e)
            })
        </script>


        <%- include(viewBodyScripts.end) %>
    </body>
</html>